package com.jdbc.lifegame.view;

import static com.jdbc.lifegame.common.UiTemplate.*;
import java.util.Scanner;
import com.jdbc.lifegame.model.vo.LifeCharacter;
import com.jdbc.lifegame.controller.LifeCharacterController;

public class ShoppingMenu {
    private LifeCharacter life;
    private Scanner sc;
    private LifeCharacterController lcc;
    
    public ShoppingMenu(LifeCharacter life, Scanner sc) {
        this.life = life;
        this.sc = sc;
        this.lcc = new LifeCharacterController();
    }
    
    public void showMenu() {
        while(true) {
            String menuName = "ì‡¼í•‘";
            menuHeader(menuName, life);
            
            System.out.println("1. ì±… êµ¬ë§¤ - ê°€ê²©: " + formatMoney(550) + ", íš¨ê³¼: ì§€ëŠ¥ +1");
            System.out.println("2. ì˜ì–‘ì œ - ê°€ê²©: " + formatMoney(3000) + ", íš¨ê³¼: ì²´ë ¥ +2");
            System.out.println("3. í–‰ìš´ì˜ ë¶€ì  - ê°€ê²©: " + formatMoney(500) + ", íš¨ê³¼: ìš´ +1");
            System.out.println("4. ë¡œë˜ - ê°€ê²©: " + formatMoney(1000));
            System.out.println("0. â† ëŒì•„ê°€ê¸°");
            line();
            System.out.print("ë©”ë‰´ ì„ íƒ: ");
            
            int sel = sc.nextInt();
            sc.nextLine();
            System.out.println("\n");
            
            switch(sel) {
                case 1: buyItem("ì±…", 550, 1, 0, 0); break;
                case 2: buyItem("ì˜ì–‘ì œ", 3000, 5, 0, 0); break;
                case 3: buyItem("í–‰ìš´ì˜ ë¶€ì ", 500, 1, 0, 0); break;
                case 4: buyLotto("ë¡œë˜", 1000); break;
                case 0: return;
                default: System.out.println("ì˜ëª»ëœ ì…ë ¥ì…ë‹ˆë‹¤.");
            }
            
            if(sel != 0) {
                System.out.println("Enter í‚¤ë¥¼ ëˆŒëŸ¬ ê³„ì†í•˜ì„¸ìš”...");
                sc.nextLine();
            }
        }
    }
    
    private void buyItem(String itemName, int price, int intBonus, int stamBonus, int luckBonus) {
        System.out.println("\n=== " + itemName + " êµ¬ë§¤ ===");
        
        if(life.getMoney() < price) {
            System.out.printf("ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: %s, ë³´ìœ : %s)\n",  formatMoney(price), formatMoney(life.getMoney()));
            return;
        }
        
        // ëŠ¥ë ¥ì¹˜ ë³€í™” ì „ ê°’ ì €ì¥
        int prevInt = life.getIntelligence();
        int prevStam = life.getStamina();
        int prevLuck = life.getLuck();
        
        // êµ¬ë§¤ ì‹¤í–‰
        life.setMoney(life.getMoney() - price);
        life.setIntelligence(life.getIntelligence() + intBonus);
        life.setStamina(life.getStamina() + stamBonus);
        life.setLuck(life.getLuck() + luckBonus);
        
        // ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ (ì‡¼í•‘ ì „ìš©)
        lcc.updateShopping(life);
        
        // êµ¬ë§¤ ì™„ë£Œ ë©”ì‹œì§€
        line();
        System.out.println("ì§€ì¶œ: " + formatMoney(price));
        
        // ëŠ¥ë ¥ì¹˜ ë³€í™” í‘œì‹œ
        if(intBonus > 0) {
            System.out.println("ì§€ëŠ¥: " + prevInt + " â†’ " + life.getIntelligence() + " (+" + intBonus + ")");
        }
        if(stamBonus > 0) {
            System.out.println("ì²´ë ¥: " + prevStam + " â†’ " + life.getStamina() + " (+" + stamBonus + ")");
        }
        if(luckBonus > 0) {
            System.out.println("ìš´: " + prevLuck + " â†’ " + life.getLuck() + " (+" + luckBonus + ")");
        }
        
        System.out.println("ë‚¨ì€ ìê¸ˆ: " + formatMoney(life.getMoney()));
        line();
        
       
    }
    
    private void buyLotto(String itemName, int price) {
    	String menuName = "ë¡œë˜";
        menuHeader(menuName, life);
        System.out.println("ê°€ê²©: " + formatMoney(price));
        System.out.println("í˜„ì¬ ìê¸ˆ: " + formatMoney(life.getMoney()));
        System.out.println("ì—°ê°„ êµ¬ë§¤ ì œí•œ: 10ê°œ");
        System.out.println("ë‹¹ì²¨ê¸ˆ: " + formatMoney(50000));
        
        // ìê¸ˆ í™•ì¸
        if(life.getMoney() < price) {
            System.out.printf("ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: %s, ë³´ìœ : %s)\n", formatMoney(price), formatMoney(life.getMoney()));
            return;
        }
        
        // ë¡œë˜ êµ¬ë§¤
        life.setMoney(life.getMoney() - price);
        
        double winChance = 0.005 + (life.getLuck() * 0.0005);
        
        if(Math.random() < winChance) {
            life.setMoney(life.getMoney() + 50000);
            System.out.println("ğŸ‰ ë‹¹ì²¨! ìƒê¸ˆ " + formatMoney(50000) + " íšë“!");
        } else {
            System.out.println("ğŸ’” ê½ì…ë‹ˆë‹¤...");
        }
 

        lcc.updateRealEstate(life);
    }
}