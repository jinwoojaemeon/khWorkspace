package com.jdbc.lifegame.view;

import static com.jdbc.lifegame.common.UiTemplate.*;
import java.util.Scanner;
import com.jdbc.lifegame.model.vo.LifeCharacter;
import com.jdbc.lifegame.controller.LifeCharacterController;

public class WorkMenu {
    private LifeCharacter life;
    private Scanner sc;
    private LifeCharacterController lcc;
    
    public WorkMenu(LifeCharacter life, Scanner sc) {
        this.life = life;
        this.sc = sc;
        this.lcc = new LifeCharacterController();
    }
    
    public boolean showMenu() {  // ë°˜í™˜ íƒ€ì…ì„ booleanìœ¼ë¡œ ë³€ê²½
        while(true) {
            String menuName = "ì¼í•˜ê¸°";
            menuHeader(menuName, life);
            System.out.println(experienceStat(life));
            line();
            
            // 1. ì•„ë¥´ë°”ì´íŠ¸
            int partTimeIncome = 1000 + (life.getPartTimeExp() * 50);
            System.out.println("1. ì•„ë¥´ë°”ì´íŠ¸ - ìˆ˜ì…: " + formatMoney(partTimeIncome) + ", ì¡°ê±´: ì—†ìŒ (ì²´ë ¥ -1)");
            
            // 2. ë…¸ê°€ë‹¤
            int laborIncome = 6000 + (life.getLaborerExp() * 50);
            boolean canLabor = life.getStamina() >= 5;
            System.out.println("2. ë…¸ê°€ë‹¤ - ìˆ˜ì…: " + formatMoney(laborIncome) + ", ì¡°ê±´: ì²´ë ¥ 5+ (ì²´ë ¥ -3, 40% í™•ë¥ ë¡œ ë¶€ìƒ -9)" + (canLabor ? "" : " âŒ"));
            
            System.out.println();
            System.out.println("==== ì¶œê·¼í•˜ê¸°");
            
            // 3. íšŒì‚¬ì›
            int employeeIncome = 3000 + (life.getEmployeeExp() * 100);
            boolean canEmployee = life.getIntelligence() >= 10 && life.getStamina() >= 5;
            System.out.println("3. íšŒì‚¬ì› - ìˆ˜ì…: " + formatMoney(employeeIncome) + ", ì¡°ê±´: ì§€ëŠ¥ 10+, ì²´ë ¥ 5+" + (canEmployee ? "" : " âŒ"));
            
            // 4. íšŒì‚¬ ì„ì›
            int executiveIncome = 6000 + (life.getExecutiveExp() * 250);
            boolean canExecutive = (life.getEmployeeExp() >= 30 && life.getIntelligence() >= 50) || 
                                  (life.getEmployeeExp() >= 10 && life.getIntelligence() >= 150);
            System.out.println("4. íšŒì‚¬ ì„ì› - ìˆ˜ì…: " + formatMoney(executiveIncome) + ", ì¡°ê±´: íšŒì‚¬ì› ê²½ë ¥ 30+, ì§€ëŠ¥ 50+" + (canExecutive ? "" : " âŒ"));
            
            // 5. ì°½ì—…ì
            int entrepreneurIncome = 20000 + (life.getEntrepreneurExp() * 500);
            boolean canEntrepreneur = (life.getEmployeeExp() >= 55 && life.getIntelligence() >= 100);
            System.out.println("5. ì°½ì—…ì - ìˆ˜ì…: " + formatMoney(entrepreneurIncome) + ", ì¡°ê±´: íšŒì‚¬ì› ê²½ë ¥ 55+, ì§€ëŠ¥ 100+" + (canEntrepreneur ? "" : " âŒ"));
            
            // 6. í˜„ì¥ ì±…ì„ì
            int supervisorIncome = 9000 + (life.getSupervisorExp() * 70);
            boolean canSupervisor = life.getStamina() >= 60 && life.getLaborerExp() >= 20;
            System.out.println("6. í˜„ì¥ ì±…ì„ì - ìˆ˜ì…: " + formatMoney(supervisorIncome) + ", ì¡°ê±´: ì²´ë ¥ 60+, ë…¸ê°€ë‹¤ ê²½ë ¥ 20+" + (canSupervisor ? "" : " âŒ"));
            
            // 7. íŠ¸ë ˆì´ë„ˆ
            int trainerIncome = 2500 + (life.getTrainerExp() * 70);
            boolean canTrainer = life.getStamina() >= 30 && life.getIntelligence() >= 10;
            System.out.println("7. íŠ¸ë ˆì´ë„ˆ - ìˆ˜ì…: " + formatMoney(trainerIncome) + ", ì¡°ê±´: ì²´ë ¥ 30+, ì§€ëŠ¥ 10+" + (canTrainer ? "" : " âŒ"));
            
            System.out.println();
            System.out.println("==== íŠ¹ìˆ˜");
            
            // 8. ìš´ë™ì„ ìˆ˜
            int athleteBaseIncome = 5000 + (life.getAthleteExp() * 500);
            boolean canAthlete = life.getStamina() >= 60 && life.getIntelligence() >= 20;
            System.out.println("8. ìš´ë™ì„ ìˆ˜ - ìˆ˜ì…: " + formatMoney(athleteBaseIncome) + "(ë³€ë™), ì¡°ê±´: ì²´ë ¥ 60+, ì§€ëŠ¥ 20+" + (canAthlete ? "" : " âŒ"));
            
            System.out.println();
            System.out.println("0. â† ëŒì•„ê°€ê¸°");
            line();
            System.out.print("ë©”ë‰´ ì„ íƒ: ");
            
            int sel = sc.nextInt();
            sc.nextLine();
            System.out.println("\n");
            
            switch(sel) {
                case 1: return executeWork("ì•„ë¥´ë°”ì´íŠ¸", partTimeIncome, true);
                case 2: return executeWork("ë…¸ê°€ë‹¤", laborIncome, canLabor);
                case 3: return executeWork("íšŒì‚¬ì›", employeeIncome, canEmployee);
                case 4: return executeWork("íšŒì‚¬ ì„ì›", executiveIncome, canExecutive);
                case 5: return executeWork("ì°½ì—…ì", entrepreneurIncome, canEntrepreneur);
                case 6: return executeWork("í˜„ì¥ ì±…ì„ì", supervisorIncome, canSupervisor);
                case 7: return executeWork("íŠ¸ë ˆì´ë„ˆ", trainerIncome, canTrainer);
                case 8: return executeWork("ìš´ë™ì„ ìˆ˜", athleteBaseIncome, canAthlete);
                case 0: return false; // ê²Œì„ ì¢…ë£Œ ì•„ë‹˜
                default: System.out.println("ì˜ëª»ëœ ì…ë ¥ì…ë‹ˆë‹¤.");
            }
        }
    }

    private boolean executeWork(String jobName, int jobIncome, boolean canWork) {
        if (!canWork) {
            System.out.println("ì¡°ê±´ì„ ì¶©ì¡±í•˜ì§€ ì•Šì•„ ì„ íƒí•  ìˆ˜ ì—†ëŠ” ì§ì—…ì…ë‹ˆë‹¤.");
            System.out.println("Enter í‚¤ë¥¼ ëˆŒëŸ¬ ê³„ì†í•˜ì„¸ìš”...");
            sc.nextLine();
            return false; // ê²Œì„ ì¢…ë£Œ ì•„ë‹˜
        }
        
        int realEstateIncome = calculateRealEstateIncome();
        
        // ìš´ë™ì„ ìˆ˜ì¸ ê²½ìš° íŠ¹ë³„ ë¡œì§ ì ìš©
        int finalJobIncome = jobIncome;
        if (jobName.equals("ìš´ë™ì„ ìˆ˜")) {
            finalJobIncome = calculateAthleteIncome(jobIncome);
        }
        
        int totalIncome = finalJobIncome + realEstateIncome;
        
        life.setAge(life.getAge() + 1);
        life.setMoney(life.getMoney() + totalIncome);
        updateJobExperience(jobName);
        lcc.execute(life);
        
        // ì²´ë ¥ 0 ì²´í¬ (ì‚¬ë§)
        if (life.getStamina() <= 0) {
            return GameEndHandler.handleGameEnd(life, "ì²´ë ¥ì´ 0ì´ ë˜ì–´ ì‚¬ë§í–ˆìŠµë‹ˆë‹¤! ê²Œì„ ì˜¤ë²„", sc);
        }
        
        // ê²°ê³¼ ì¶œë ¥
        line();
        System.out.println(jobName + "ìœ¼ë¡œ 1ë…„ê°„ ê·¼ë¬´í–ˆìŠµë‹ˆë‹¤!");
        System.out.println("ê·¼ë¡œì†Œë“: " + formatMoney(finalJobIncome));
        if (realEstateIncome > 0) {
            System.out.println("íˆ¬ì ìˆ˜ìµê¸ˆ: " + formatMoney(realEstateIncome));
        }
        System.out.println("ì´ ìˆ˜ì…: " + formatMoney(totalIncome));
        System.out.println("ë‚˜ì´: " + (life.getAge() - 1) + "ì„¸ â†’ " + life.getAge() + "ì„¸");
        System.out.println("í˜„ì¬ ìì‚°: " + formatMoney(life.getMoney()));
        line();
        
        // 100ì„¸ ì²´í¬
        if (life.getAge() >= 100) {
            return GameEndHandler.handleGameEnd(life, "100ì„¸ê°€ ë˜ì–´ ì¸ìƒì„ ì™„ì£¼í–ˆìŠµë‹ˆë‹¤! ì¶•í•˜í•©ë‹ˆë‹¤!", sc);
        }
        
        System.out.println("Enter í‚¤ë¥¼ ëˆŒëŸ¬ ê³„ì†í•˜ì„¸ìš”...");
        sc.nextLine();
        return false; // ê²Œì„ ì¢…ë£Œ ì•„ë‹˜
    }
    
    // ë¶€ë™ì‚° ìˆ˜ìµ ê³„ì‚°
    private int calculateRealEstateIncome() {
        int income = 0;
        if (life.isHasApartment()) {
            income += 300; 
        }
        if (life.isHasBuilding()) {
            income += 2000; 
        }
        if (life.isHasHotel()) {
            income += 5000; 
        }
        return income;
    }

    private void updateJobExperience(String jobName) {
        switch(jobName) {
            case "ì•„ë¥´ë°”ì´íŠ¸":
                life.setPartTimeExp(life.getPartTimeExp() + 1);
                // ì•„ë¥´ë°”ì´íŠ¸ë„ ì²´ë ¥ 1 ê°ì†Œ
                life.setStamina(Math.max(0, life.getStamina() - 1));
                System.out.println("ì•„ë¥´ë°”ì´íŠ¸ë¡œ ì¸í•´ ì²´ë ¥ì´ 1 ê°ì†Œí–ˆìŠµë‹ˆë‹¤. (í˜„ì¬ ì²´ë ¥: " + life.getStamina() + ")");
                break;
            case "ë…¸ê°€ë‹¤":
                life.setLaborerExp(life.getLaborerExp() + 1);
                // ê¸°ë³¸ì ìœ¼ë¡œ ì²´ë ¥ 3 ê°ì†Œ
                life.setStamina(Math.max(0, life.getStamina() - 3));
                System.out.println("í˜ë“  ì¼ë¡œ ì²´ë ¥ì´ 3 ê°ì†Œí–ˆìŠµë‹ˆë‹¤. (í˜„ì¬ ì²´ë ¥: " + life.getStamina() + ")");
                
                // 40% í™•ë¥ ë¡œ ë¶€ìƒ (ì¶”ê°€ ì²´ë ¥ 9 ê°ì†Œ)
                if (Math.random() < 0.4) {
                    life.setStamina(Math.max(0, life.getStamina() - 9));
                    System.out.println("â— ì‘ì—… ì¤‘ ë¶€ìƒì„ ë‹¹í•´ ì²´ë ¥ì´ ì¶”ê°€ë¡œ 9 ê°ì†Œí–ˆìŠµë‹ˆë‹¤! (í˜„ì¬ ì²´ë ¥: " + life.getStamina() + ")");
                }
                break;
            case "íšŒì‚¬ì›":
                life.setEmployeeExp(life.getEmployeeExp() + 1);
                if (life.getEmployeeExp() % 5 == 0) {
                    life.setStamina(Math.max(0, life.getStamina() - 3));
                    System.out.println("ì—…ë¬´ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ ì²´ë ¥ì´ 3 ê°ì†Œí–ˆìŠµë‹ˆë‹¤. (í˜„ì¬ ì²´ë ¥: " + life.getStamina() + ")");
                }
                break;
            case "íšŒì‚¬ ì„ì›":
                life.setExecutiveExp(life.getExecutiveExp() + 1);
                if (life.getExecutiveExp() == 1) {
                    int bonus = (int)(life.getEmployeeExp() * 0.4);
                    life.setExecutiveExp(life.getExecutiveExp() + bonus);
                    System.out.println("íšŒì‚¬ì› ê²½ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ ì„ì› ê²½ë ¥ " + bonus + "ë…„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
                }
                break;
            case "ì°½ì—…ì":
                life.setEntrepreneurExp(life.getEntrepreneurExp() + 1);
                
                // 8% í™•ë¥ ë¡œ íšŒì‚¬ ë¶€ë„ (ì „ì¬ì‚° ëª°ìˆ˜)
                if (Math.random() < 0.08) {
                    try {
                        Thread.sleep(2000);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    System.out.println("ğŸ’¥ íšŒì‚¬ê°€ ë¶€ë„ë‚¬ìŠµë‹ˆë‹¤!");
                    System.out.println("ë¹šì„ ê°šê¸° ìœ„í•´ ëª¨ë“  ìì‚°ì„ ìƒì—ˆìŠµë‹ˆë‹¤...");
                    System.out.println("ìƒì€ ìì‚°:");
                    System.out.println("  ğŸ’° í˜„ê¸ˆ: " + formatMoney(life.getMoney()));
                    if (life.isHasApartment()) System.out.println("  ğŸ  ì•„íŒŒíŠ¸");
                    if (life.isHasBuilding()) System.out.println("  ğŸ¢ ë¹Œë”©");
                    if (life.isHasHotel()) System.out.println("  ğŸ¨ í˜¸í…”");
                    if (life.getStockCount() > 0) System.out.println("  ğŸ“ˆ ì£¼ì‹ " + life.getStockCount() + "ì£¼");
                    
                    // ì „ì¬ì‚° ëª°ìˆ˜
                    life.setMoney(0);
                    life.setHasApartment(false);
                    life.setHasBuilding(false);
                    life.setHasHotel(false);
                    life.setStockCount(0);
                    
                    System.out.println("ğŸ’” ë‹¤ì‹œ ì²˜ìŒë¶€í„° ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤...");
                    
                  
                }
                break;
            case "í˜„ì¥ ì±…ì„ì":
                life.setSupervisorExp(life.getSupervisorExp() + 1);
                if (life.getSupervisorExp() == 1) {
                    int bonus = (int)(life.getLaborerExp() * 0.1);
                    life.setSupervisorExp(life.getSupervisorExp() + bonus);
                    System.out.println("ë…¸ê°€ë‹¤ ê²½ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ ì±…ì„ì ê²½ë ¥ " + bonus + "ë…„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
                }
                
                // 12% í™•ë¥ ë¡œ ë¶€ì‹¤ê³µì‚¬ ë°œê° (ì „ì¬ì‚° ëª°ìˆ˜)
                if (Math.random() < 0.12) {
                    System.out.println("ğŸš¨ ë¶€ì‹¤ê³µì‚¬ê°€ ë°œê°ë˜ì—ˆìŠµë‹ˆë‹¤!");
                    try {
                        Thread.sleep(2000);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    System.out.println("ì†í•´ë°°ìƒê³¼ ë²Œê¸ˆìœ¼ë¡œ ëª¨ë“  ìì‚°ì„ ìƒì—ˆìŠµë‹ˆë‹¤...");
                    System.out.println("ìƒì€ ìì‚°:");
                    System.out.println("  ğŸ’° í˜„ê¸ˆ: " + formatMoney(life.getMoney()));
                    if (life.isHasApartment()) System.out.println("  ğŸ  ì•„íŒŒíŠ¸");
                    if (life.isHasBuilding()) System.out.println("  ğŸ¢ ë¹Œë”©");
                    if (life.isHasHotel()) System.out.println("  ğŸ¨ í˜¸í…”");
                    if (life.getStockCount() > 0) System.out.println("  ğŸ“ˆ ì£¼ì‹ " + life.getStockCount() + "ì£¼");
                    
                    // ì „ì¬ì‚° ëª°ìˆ˜
                    life.setMoney(0);
                    life.setHasApartment(false);
                    life.setHasBuilding(false);
                    life.setHasHotel(false);
                    life.setStockCount(0);
                    
                    System.out.println("ğŸ’” ë²•ì  ì±…ì„ìœ¼ë¡œ ì¸í•´ ëª¨ë“  ê²ƒì„ ìƒì—ˆìŠµë‹ˆë‹¤...");
                    
                   
                }
                break;
            case "íŠ¸ë ˆì´ë„ˆ":
                life.setTrainerExp(life.getTrainerExp() + 1);
                if (life.getTrainerExp() % 5 == 0) {
                    life.setStamina(Math.max(0, life.getStamina() - 1));
                    System.out.println("ì§€ì†ì ì¸ í™œë™ìœ¼ë¡œ ì²´ë ¥ì´ 1 ê°ì†Œí–ˆìŠµë‹ˆë‹¤. (í˜„ì¬ ì²´ë ¥: " + life.getStamina() + ")");
                }
                break;
            case "ìš´ë™ì„ ìˆ˜":
                life.setAthleteExp(life.getAthleteExp() + 1);
                
                // 7% í™•ë¥ ë¡œ ë¶€ìƒ (ì²´ë ¥ 50 ê°ì†Œ)
                if (Math.random() < 0.07) {
                    life.setStamina(Math.max(0, life.getStamina() - 50));
                    System.out.println("ğŸš‘ ì‹¬ê°í•œ ë¶€ìƒì„ ë‹¹í–ˆìŠµë‹ˆë‹¤! ì²´ë ¥ -50 (í˜„ì¬ ì²´ë ¥: " + life.getStamina() + ")");
                }
                
                break;
        }
    }
    
    // ìš´ë™ì„ ìˆ˜ ê¸‰ì—¬ ê³„ì‚° ë©”ì„œë“œ
    private int calculateAthleteIncome(int baseIncome) {
        int finalIncome = baseIncome;
        
        // 10% + (ìš´ë™ì„ ìˆ˜ ê²½ë ¥ Ã— 1%) í™•ë¥ ë¡œ ì¸ê¸°ì„ ìˆ˜ê°€ ë˜ì–´ ê¸‰ì—¬ ìƒìŠ¹
        double starChance = 0.10 + (life.getAthleteExp() * 0.01);
        if (Math.random() < starChance) {
            finalIncome += 30000; // ê´‘ê³  ìˆ˜ìµ 3ì–µ ì¶”ê°€
            System.out.println("â­ ì¸ê¸° ìŠ¤íƒ€ ì„ ìˆ˜ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤! ê´‘ê³  ìˆ˜ìµ +" + formatMoney(30000));
        }
        
        // 5% í™•ë¥ ë¡œ ì‚¬ê³  (ê¸‰ì—¬ê°€ 3000ë§Œì›ìœ¼ë¡œ ê³ ì •)
        if (Math.random() < 0.05) {
            finalIncome = 3000; // ì‚¬ê³  ì‹œ ìµœì†Œì—°ë´‰ 3000ë§Œì›ë§Œ ë°›ìŒ
            System.out.println("ğŸ’¥ ìŠ¤ìº”ë“¤/ì‚¬ê³ ë¡œ ì¸í•´ ê³„ì•½ì´ íŒŒê¸°ë˜ì—ˆìŠµë‹ˆë‹¤! ìµœì†Œì—°ë´‰ë§Œ ì§€ê¸‰: " + formatMoney(3000));
        }
        
        return finalIncome;
    }
}